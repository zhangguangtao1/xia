<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>瀑布流布局</title>
		<style type="text/css">
			*{margin:0;padding:0;}
			.main{position:relative;}
			.clearfix:after{height:0;display:block;overflow:hidden;content:"";clear:both;}
			img{width:300px;display:block;}
			.box{float:left;padding:20px 0 0 20px;}
			.pic{padding:10px;border:1px solid #ccc;border-radius:10px;box-shadow:0 0 5px #CCCCCC;}
		</style>
	</head>
	<body>
		<div class="main clearfix">
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/1.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/2.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/3.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/4.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/5.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/1.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/2.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/3.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/4.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/5.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/1.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/2.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/3.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/4.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/5.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/1.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/2.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/3.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/4.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/5.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/1.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/2.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/3.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/4.jpg" alt="" /></div>
			</div>
			<div class="box">
				<div class="pic"><img src="http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/5.jpg" alt="" /></div>
			</div>
		</div>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<script type="text/javascript">
			$(function(){
				waterFall();
				$(window).scroll(function(){
					var lastH = $(".box").last().offset().top;
					var scrollDis = $(window).scrollTop() + $(window).height();
					var data = {"dd":["http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/5.jpg","http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/4.jpg","http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/3.jpg","http://demo.sc.chinaz.com//Files/DownLoad/webjs1/201405/jiaoben2331/images/2.jpg"]}
					var $main = $(".main");
						if(lastH < scrollDis){
							for(var j = 0;j < data.dd.length;j++){
								var img = $('<div class="box"><div class="pic"><img src="" alt="" /></div></div>');
								img.appendTo($main);
								img.find(".pic").find("img").attr("src",data.dd[j]);
							}
					}
					waterFall();
				})
			})
			function waterFall(){
				var screenW = $(window).width();
				var boxW = $(".box").eq(0).outerWidth();
				var cols = Math.floor(screenW/boxW);
				var allW = cols*boxW;
				$(".main").css({"width":allW,"margin":"0 auto"})
				var hArr = [];
				for(var i = 0;i < $(".box").length;i++){
					if(i < cols){
						hArr.push($(".box").eq(i).outerHeight());
					}else{
						var minH = Math.min.apply(null,hArr);
						var index = hArr.indexOf(minH);
						$(".box").eq(i).css({"position":"absolute","left":boxW*index,"top":minH});
						hArr[index] = hArr[index] + $(".box").eq(i).outerHeight();
					}
				}
			}
		</script>
	</body>
</html>
